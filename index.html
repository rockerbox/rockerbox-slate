<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>API Reference</title>

    <link href="stylesheets/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
      <script src="javascripts/all.js" type="text/javascript"></script>

      <script>
        $(function() {
          setupLanguages(["shell","python"]);
        });
      </script>
  </head>

  <body class="index">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="logo.png" />
        <div class="lang-selector">
              <a href="#" data-language-name="shell">shell</a>
              <a href="#" data-language-name="python">python</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='#'>Sign Up for a Developer Key</a></li>
            <li><a href='http://github.com/tripit/slate'>Documentation Powered by Slate</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="crusher">Crusher</h1>

<p>Crusher allows you to look at the on-site activity user and determine how the on-site activity is influenced by a users off-site browsing activity.
These are the APIs that power crusher and make it possible to analyze on-site versus off-site activity.</p>

<h2 id="background">Background</h2>

<p>Crusher is a collection of analytics, machine learning and ad-buying technologies that make it possible for a user to: </p>

<ul>
<li>collect information about on-site and off-site activity</li>
<li>classify and understand how these behaviors influence each other</li>
<li>target ads based on these different classifications </li>
</ul>

<h2 id="authorization">Authorization</h2>

<p>We need to add authorization to all of these services and remove the advertiser parameter from the API.</p>

<p>We will be reusing our authentication and just need to label the endpoints are authenticated in python with the appropriate decorator.</p>

<h3 id="cookie-based">Cookie-based</h3>

<h3 id="header-based">Header-based</h3>

<h1 id="on-site-activity">On-site Activity</h1>

<p>These APIs allow us to search for a particular pattern or group of patterns that occur on the query string of the on-page url. 
The search APIs give us the ability to look at the following characterstics about a patterns:</p>

<ul>
<li>URLs: these are the URLs that match the pattern</li>
<li>UIDs: these are the UIDs that match the pattern</li>
<li>Count: this gives us a summary about the pattern</li>
<li>Timeseries: this gives us a timeseries summary about how the pattern changes over time</li>
</ul>

          <h2 id="url-search">URL Search</h2>

<blockquote>
<p>Request (count for a single pattern): </p>
</blockquote>
<pre class="highlight shell"><code><span class="c"># TODO: !!</span>
<span class="c"># current -- needs format and advertiser on end of URL "&amp;format=json&amp;advertiser=baublebar"</span>
<span class="c"># proposed -- use authentication</span>

curl <span class="s2">"http://crusher.getrockerbox.com/crusher/search/count?search=necklaces"</span> 

</code></pre>

<blockquote>
<p>Response (count for single pattern):</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"logic"</span><span class="p">:</span><span class="w"> </span><span class="s2">"should"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"search"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"necklaces"</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"summary"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"num_users"</span><span class="p">:</span><span class="w"> </span><span class="mi">1200</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>Request 
- urls that match pattern</p>
</blockquote>
<pre class="highlight shell"><code>
curl <span class="s2">"http://crusher.getrockerbox.com/crusher/search/urls?search=rockerbox"</span>
</code></pre>

<blockquote>
<p>Response 
- urls that match pattern</p>
</blockquote>
<pre class="highlight shell"><code><span class="o">{</span>
    <span class="s2">"logic"</span>: <span class="s2">"must"</span>,
    <span class="s2">"results"</span>: <span class="o">[</span>
        <span class="o">{</span>
            <span class="s2">"count"</span>: 1,
            <span class="s2">"url"</span>: <span class="s2">"http://www.baublebar.com/whats-new/just-added.html?cvosrc=display.rockerbox.072015_JulyDigAdsRefresh_300x250_3_9718787&amp;utm_source=rockerbox&amp;utm_medium=display&amp;utm_campaign=072015_JulyDigAdsRefresh_300x250_3_9718787"</span>
        <span class="o">}</span>,
        <span class="o">{</span>
            <span class="s2">"count"</span>: 1,
            <span class="s2">"url"</span>: <span class="s2">"http://www.baublebar.com/whats-new/just-added.html?cvosrc=display.rockerbox.072015_JulyDigAdsRefresh_300x600_1_4279296&amp;utm_source=rockerbox&amp;utm_medium=display&amp;utm_campaign=072015_JulyDigAdsRefresh_300x600_1_4279296"</span>
        <span class="o">}</span>,
        <span class="o">{</span>
            <span class="s2">"count"</span>: 1,
            <span class="s2">"url"</span>: <span class="s2">"http://www.baublebar.com/whats-new/just-added.html?cvosrc=display.rockerbox.072015_JulyDigAdsRefresh_728x90_1_3810899&amp;utm_source=rockerbox&amp;utm_medium=display&amp;utm_campaign=072015_JulyDigAdsRefresh_728x90_1_3810899"</span>
        <span class="o">}</span>
    <span class="o">]</span>,
    <span class="s2">"search"</span>: <span class="o">[</span>
        <span class="s2">"rockerbox"</span>
    <span class="o">]</span>,
    <span class="s2">"summary"</span>: <span class="o">{</span>
        <span class="s2">"num_urls"</span>: 3,
        <span class="s2">"num_users"</span>: 3
    <span class="o">}</span>,
    <span class="s2">"timeout"</span>: 60
<span class="o">}</span>
</code></pre>

<blockquote>
<p>Request 
- uids for multiple patterns using <strong>AND</strong> logic</p>
</blockquote>
<pre class="highlight shell"><code>
<span class="c"># TODO: !!</span>
<span class="c"># current (defaults to or)</span>
<span class="c"># propsoed (should default to AND)</span>
curl <span class="s2">"http://crusher.getrockerbox.com/crusher/search/uids?search=necklaces,pepperjam"</span>
</code></pre>

<blockquote>
<p>Response 
- uids for multiple patterns using <strong>AND</strong> logic</p>
</blockquote>
<pre class="highlight shell"><code><span class="o">{</span>
    <span class="s2">"logic"</span>: <span class="s2">"must"</span>,
    <span class="s2">"results"</span>: <span class="o">[</span>
        <span class="s2">"1658345989907319038"</span>,
        <span class="s2">"8544236950523550015"</span>,
        <span class="s2">"3647988598677495450"</span>,
        <span class="s2">"8377247509133269564"</span>,
        <span class="s2">"8728953026525723133"</span>,
        <span class="s2">"4371882728305824796"</span>,
        <span class="s2">"4355801865744751912"</span>,
        <span class="s2">"3071870354224070944"</span>,
        <span class="s2">"8282590386514880072"</span>,
        <span class="s2">"5213257658303005847"</span>,
        <span class="s2">"682573251720908722"</span>
    <span class="o">]</span>,
    <span class="s2">"search"</span>: <span class="o">[</span>
        <span class="s2">"necklaces"</span>,
        <span class="s2">"pepperjam"</span>
    <span class="o">]</span>,
    <span class="s2">"summary"</span>: <span class="o">{</span>
        <span class="s2">"num_users"</span>: 11
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>

<blockquote>
<p>Request 
- timeseries for multiple patterns using <strong>AND</strong> logic</p>
</blockquote>
<pre class="highlight shell"><code>
<span class="c"># TODO: !!</span>
<span class="c"># current (defaults to or)</span>
<span class="c"># propsoed (should default to AND)</span>
curl <span class="s2">"http://crusher.getrockerbox.com/crusher/search/timeseries?search=necklaces,pepperjam"</span>
</code></pre>

<blockquote>
<p>Response 
- timeseries for multiple patterns using <strong>AND</strong> logic</p>
</blockquote>
<pre class="highlight shell"><code><span class="o">{</span>
    <span class="s2">"logic"</span>: <span class="s2">"must"</span>,
    <span class="s2">"results"</span>: <span class="o">[</span>
        <span class="o">{</span>
            <span class="s2">"date"</span>: <span class="s2">"2015-07-29 00:00:00"</span>,
            <span class="s2">"num_users"</span>: 4,
            <span class="s2">"num_visits"</span>: 5
        <span class="o">}</span>,
        <span class="o">{</span>
            <span class="s2">"date"</span>: <span class="s2">"2015-07-30 00:00:00"</span>,
            <span class="s2">"num_users"</span>: 7,
            <span class="s2">"num_visits"</span>: 7
        <span class="o">}</span>
    <span class="o">]</span>,
    <span class="s2">"search"</span>: <span class="o">[</span>
        <span class="s2">"necklaces"</span>,
        <span class="s2">"pepperjam"</span>
    <span class="o">]</span>,
    <span class="s2">"summary"</span>: <span class="o">{</span>
        <span class="s2">"num_users"</span>: 11,
        <span class="s2">"num_visits"</span>: 12
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>

<blockquote>
<p>Request 
- timeseries for multiple patterns using <strong>OR</strong> logic</p>
</blockquote>
<pre class="highlight shell"><code>
curl <span class="s2">"http://crusher.getrockerbox.com/crusher/search/timeseries?search=necklaces,pepperjam&amp;logic=or"</span>
</code></pre>

<blockquote>
<p>Response 
- timeseries for multiple patterns using <strong>OR</strong> logic</p>
</blockquote>
<pre class="highlight shell"><code><span class="o">{</span>
    <span class="s2">"logic"</span>: <span class="s2">"should"</span>,
    <span class="s2">"results"</span>: <span class="o">[</span>
        <span class="o">{</span>
            <span class="s2">"date"</span>: <span class="s2">"2015-07-29 00:00:00"</span>,
            <span class="s2">"num_users"</span>: 708,
            <span class="s2">"num_visits"</span>: 2327
        <span class="o">}</span>,
        <span class="o">{</span>
            <span class="s2">"date"</span>: <span class="s2">"2015-07-30 00:00:00"</span>,
            <span class="s2">"num_users"</span>: 993,
            <span class="s2">"num_visits"</span>: 2858
        <span class="o">}</span>
    <span class="o">]</span>,
    <span class="s2">"search"</span>: <span class="o">[</span>
        <span class="s2">"necklaces"</span>,
        <span class="s2">"pepperjam"</span>
    <span class="o">]</span>,
    <span class="s2">"summary"</span>: <span class="o">{</span>
        <span class="s2">"num_users"</span>: 1653,
        <span class="s2">"num_visits"</span>: 5185
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>

<p>This endpoint allows us to search for the occurance of a pattern or multiple patterns within a single URL.</p>

<p>The pattern search API supports:</p>

<ul>
<li>four query result types (urls, uids, count, timeseries).</li>
<li>two types of logic when searching for a pattern within a URL (&ldquo;or&rdquo;,&ldquo;and&rdquo;)</li>
</ul>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET http://crusher.getrockerbox.com/crusher/search/&lt;QUERY_TYPE&gt;</code></p>

<h3 id="query-parameters">Query Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>search</td>
<td>None</td>
<td>this is a <em>required</em> field. it is a string or comman seperated string of terms  we will look for in the URL. If multiple terms are used, the logic parameter will be used param will be used to perform the search</td>
</tr>
<tr>
<td>logic</td>
<td>and</td>
<td>this specifies the logic to use for a search term. specifically, if we are looking for nature,nuture in a url, or would require either nature or nuture, and would require both nature and nuture</td>
</tr>
<tr>
<td>format</td>
<td>json</td>
<td>this specifies the response type. currently only json is supported</td>
</tr>
<tr>
<td>timeout</td>
<td>60</td>
<td>this is the amount of time in seconds we will attempt to process the query before timing out. Its default and max value is 60 seconds</td>
</tr>
</tbody></table>

<aside class="default">Note that the search field is required for all queries</aside>

<h3 id="json-response">JSON Response</h3>

<p>The JSON response will be formatted with the following fields:</p>

<table><thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>search</td>
<td>these are the terms entered as commas seperated values to the search QS parameter</td>
</tr>
<tr>
<td>logic</td>
<td>this is the logic used interally to evaluate URLs against the pattern(s) specified</td>
</tr>
<tr>
<td>summary</td>
<td>this is a summary object describing the results. depending on the query type it will have different values but will always be present</td>
</tr>
<tr>
<td>results</td>
<td>the result object is based on the query type. It will be present for all results with the exception of the count, which will only have a summary object</td>
</tr>
</tbody></table>

<h3 id="json-result-objects">JSON Result Objects</h3>

<p>This describes the different JSON Result object types that one can expect for the different query types</p>

<table><thead>
<tr>
<th>Query Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>urls</td>
<td>this is a list of objects that contain the URL and the number of matches for that url. it will be sorted based on count</td>
</tr>
<tr>
<td>uids</td>
<td>this is a list of UID strings associated with the pattern</td>
</tr>
<tr>
<td>timeseries</td>
<td>this is a timeseries which shows the counts at each respective date</td>
</tr>
</tbody></table>

<aside class="warning">Note that the **count** query type does not have a results object present</aside>

          <h2 id="multiple-url-search">Multiple URL Search</h2>

<p>This endpoint allows us search for users who visited multiple URL patterns and get the union or intersection of the visits that have occured on these matched pages.</p>

<p>Similar to the the single URL search, this API support:</p>

<ul>
<li>the query result types: (uids,count,timeseries)</li>
<li>two type of logic: (union, intersection)</li>
</ul>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET http://crusher.getrockerbox.com/crusher/pattern_search/&lt;QUERY_TYPE&gt;</code></p>

<h3 id="query-parameters">Query Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>search</td>
<td>None</td>
<td>this is a <strong>required</strong> field. the search string is made up of comman seperated patterns and pipe seperated pattern groups. the comma seperated pattern requires all occurances of the pattern to be present in matched urls. the pipe seperation between pattern allows one to look at either the union or intersection of the users who have visited urls that matched the pattern string.</td>
</tr>
<tr>
<td>logic</td>
<td>intersection</td>
<td>this specifies whether were looking at the union or intersection of the pattern strings. A union results in reporting based on all the patterns matched. An intersection is looking at the intersection of the two patterns</td>
</tr>
<tr>
<td>format</td>
<td>json</td>
<td>this specifies the response type. currently only json is supported</td>
</tr>
<tr>
<td>timeout</td>
<td>60</td>
<td>this is the amount of time in seconds we will attempt to process the query before timing out. Its default and max value is 60 seconds</td>
</tr>
</tbody></table>

<h3 id="more-on-the-quot-search-quot-and-quot-logic-quot-parameters">More on the &ldquo;search&rdquo; and &ldquo;logic&rdquo; parameters</h3>

<p>The search parameter is made up of multiple <strong>URL pattern strings</strong> seperated by pipe characters. 
A <strong>URL pattern string</strong> is a comma seperated string of values, e.g. &ldquo;nature,nuture&rdquo;.
When this API evaluates a URL pattern string, the indivual patterns will be evaluated using an  <strong>AND</strong> operation, meaning that every url that matches this pattern must contain all terms in the string.</p>

<p>The following is an example of two URL pattern strings used as a search parameter:</p>

<p><code class="prettyprint">/crusher/pattern_search?search=nature,nuture|wild</code></p>

<p>Each URL pattern string is used to find the users associated with each URL pattern string.</p>

<table><thead>
<tr>
<th>Pattern</th>
<th>Users</th>
</tr>
</thead><tbody>
<tr>
<td>nature,nuture</td>
<td>User group 1</td>
</tr>
<tr>
<td>wild</td>
<td>User group 2</td>
</tr>
</tbody></table>

<p>The logic parameter will then be used to either take the union or the intersection of the users that match. </p>

<table><thead>
<tr>
<th>Logic</th>
<th>Matches</th>
</tr>
</thead><tbody>
<tr>
<td>Union</td>
<td>users who match any of the patterns</td>
</tr>
<tr>
<td>Intersection</td>
<td>users who many all of the patterns</td>
</tr>
</tbody></table>

<p>Finally, the eligible users will be selected out of the overall data set and an aggregated result will be returned. Specifically,</p>

<table><thead>
<tr>
<th>Logic</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>Union</td>
<td>This is an aggregation of all of the resulting patterns</td>
</tr>
<tr>
<td>Intersection</td>
<td>The resulting data set is an aggregation of all (URL, user) combinations from any pattern in search parameter but limited to the subset of the user groups</td>
</tr>
</tbody></table>

          <h1 id="errors">Errors</h1>

<aside class="notice">This error section is stored in a separate file in `includes/_errors.md`. Slate allows you to optionally separate out your docs into many files&hellip;just save them to the `includes` folder and add them to the top of your `index.md`&rsquo;s frontmatter. Files are included in the order listed.</aside>

<p>The Kittn API uses the following error codes:</p>

<table><thead>
<tr>
<th>Error Code</th>
<th>Meaning</th>
</tr>
</thead><tbody>
<tr>
<td>400</td>
<td>Bad Request &ndash; Your request sucks</td>
</tr>
<tr>
<td>401</td>
<td>Unauthorized &ndash; Your API key is wrong</td>
</tr>
<tr>
<td>403</td>
<td>Forbidden &ndash; The kitten requested is hidden for administrators only</td>
</tr>
<tr>
<td>404</td>
<td>Not Found &ndash; The specified kitten could not be found</td>
</tr>
<tr>
<td>405</td>
<td>Method Not Allowed &ndash; You tried to access a kitten with an invalid method</td>
</tr>
<tr>
<td>406</td>
<td>Not Acceptable &ndash; You requested a format that isn&rsquo;t json</td>
</tr>
<tr>
<td>410</td>
<td>Gone &ndash; The kitten requested has been removed from our servers</td>
</tr>
<tr>
<td>418</td>
<td>I&rsquo;m a teapot</td>
</tr>
<tr>
<td>429</td>
<td>Too Many Requests &ndash; You&rsquo;re requesting too many kittens! Slow down!</td>
</tr>
<tr>
<td>500</td>
<td>Internal Server Error &ndash; We had a problem with our server. Try again later.</td>
</tr>
<tr>
<td>503</td>
<td>Service Unavailable &ndash; We&rsquo;re temporarially offline for maintanance. Please try again later.</td>
</tr>
</tbody></table>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="shell">shell</a>
                <a href="#" data-language-name="python">python</a>
          </div>
      </div>
    </div>
  </body>
</html>
